{% extends "demo/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h3 class="fw-bold text-dark mb-0">
                {% if car.id %}Edit Data Mobil{% else %}Tambah Mobil Baru{% endif %}
            </h3>
            <p class="text-muted small mb-0">Formulir Manajemen Data Inventaris.</p>
        </div>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        {% for hidden in form.hidden_fields %}
            {{ hidden }}
        {% endfor %}

        {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold text-primary"><i class="fas fa-info-circle me-2"></i>Informasi Umum</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Nama Mobil</label>
                            {{ form.nama }}
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold small text-muted">Merek</label>
                                {{ form.merek }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold small text-muted">Model / Varian</label>
                                {{ form.model }}
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Deskripsi</label>
                            {{ form.deskripsi }}
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold text-info"><i class="fas fa-cogs me-2"></i>Spesifikasi Teknis</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Tahun</label>
                                {{ form.tahun }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Kilometer</label>
                                <div class="input-group">
                                    {{ form.kilometer }}
                                    <span class="input-group-text">km</span>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Transmisi</label>
                                {{ form.transmisi }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Bahan Bakar</label>
                                {{ form.jenis_bahan_bakar }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Kapasitas Mesin</label>
                                {{ form.mesin }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label fw-bold small text-muted">Jumlah Kursi</label>
                                {{ form.tempat_duduk }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card mb-3">
                    <div class="card-body p-3">
                        <button type="submit" class="btn btn-primary w-100 mb-2 fw-bold shadow-sm">
                            <i class="fas fa-save me-2"></i>Simpan Data
                        </button>
                        
                        {% if car.id %}
                        <a href="{% url 'detail_car' car.id %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-times me-2"></i>Batal
                        </a>
                        {% else %}
                        <a href="{% url 'demo_carlist_dashboard' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-arrow-left me-2"></i>Kembali
                        </a>
                        {% endif %}
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold text-success"><i class="fas fa-tag me-2"></i>Data Penjualan</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold small text-muted">Harga Jual</label>
                            <div class="input-group">
                                <span class="input-group-text fw-bold">Rp</span>
                                {{ form.harga }}
                            </div>
                        </div>
                        <div class="mb-0">
                            <label class="form-label fw-bold small text-muted">Status</label>
                            {{ form.status }}
                        </div>
                    </div>
                </div>

                <div class="card mb-3">
                    <div class="card-header bg-white">
                        <h6 class="mb-0 fw-bold text-dark"><i class="fas fa-image me-2"></i>Foto Utama</h6>
                    </div>
                    <div class="card-body text-center">
                        <div class="image-upload-wrapper mb-3 p-2 bg-light border rounded">
                            {% if form.instance.gambar %}
                                <img src="{{ form.instance.gambar.url }}" id="imgPreview" class="img-fluid rounded" style="max-height: 180px;">
                            {% else %}
                                <img src="https://via.placeholder.com/300x200?text=Preview+Foto" id="imgPreview" class="img-fluid rounded opacity-50" style="max-height: 180px;">
                            {% endif %}
                        </div>
                        <div class="text-start">
                            {% if form.gambar %}
                                {{ form.gambar }}
                            {% else %}
                                <div class="alert alert-warning small py-1 px-2">
                                    <i class="fas fa-exclamation-triangle"></i> Field 'gambar' belum ditambahkan di forms.py
                                </div>
                            {% endif %}
                            <small class="text-muted d-block mt-2" style="font-size: 0.8rem;">*Format JPG/PNG, Max 5MB</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Style Input Django
        var inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(function(input) {
            if (input.type !== 'checkbox' && input.type !== 'radio' && input.type !== 'file' && input.type !== 'hidden') {
                input.classList.add('form-control');
            }
        });

        // Style Input File
        var fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(function(input) {
            input.classList.add('form-control'); 
            input.setAttribute('onchange', 'previewImage(this)');
        });
    });

    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imgPreview').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock content %}